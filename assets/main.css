/* ===== BASE STYLES ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
  color: #334155;
  background: #f8fafc;
  overflow-x: hidden;
  transition: all 0.3s ease;
}

/* ===== THEME VARIABLES ===== */
:root {
  --primary-color: #10b981;
  --primary-dark: #059669;
  --secondary-color: #3b82f6;
  --accent-color: #8b5cf6;
  --success-color: #22c55e;
  --warning-color: #f59e0b;
  --error-color: #ef4444;
  --background: #f8fafc;
  --surface: #ffffff;
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --border-color: #e2e8f0;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  --glass: rgba(255,255,255,.65);
  --border: rgba(255,255,255,.15);
  --ink: #1e293b;
  --muted: #64748b;
  --bg-primary: #f8fafc;
  --bg-secondary: #ffffff;
  --accent: #8b5cf6;
  
  /* Scene variables */
  --sky-day-from: #a8e0ff;
  --sky-day-to: #fdfbfb;
  --sky-night-from: #0b1026;
  --sky-night-to: #1b2354;
  --sun: #ffd166;
  --moon: #e5e7ff;
  --grass-day: #2aa657;
  --grass-night: #1e7540;
  --t: 600ms ease;
}

[data-theme="dark"] {
  --background: #0f172a;
  --surface: #1e293b;
  --text-primary: #f1f5f9;
  --text-secondary: #94a3b8;
  --border-color: #334155;
  --glass: rgba(15,23,42,.85);
  --border: rgba(71,85,105,.35);
  --ink: #f1f5f9;
  --muted: #94a3b8;
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --accent: #a855f7;
}

[data-theme="dark"] body {
  background: var(--background);
  color: var(--text-primary);
}

/* ===== UTILITY CLASSES ===== */
.hidden {
  display: none !important;
}

.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

.slide-up {
  animation: slideUp 0.3s ease-out;
}

.glass-morphism {
  background: var(--glass);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
}

/* ===== ANIMATIONS ===== */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
  }
}

@keyframes pageTransition {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ===== PAGE TRANSITION ===== */
.page-transition {
  animation: pageTransition 0.5s ease-out;
}

.page-fade-out {
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.3s ease-in;
}

/* ===== CONTAINER SYSTEM ===== */
.container,
.page-container,
.header-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
}

.page-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 60px;
}

/* ===== SVG CONSTRAINTS ===== */
svg {
  max-width: 100%;
  height: auto;
  overflow: visible;
}

.tree-container {
  width: 100%;
  max-width: 100vw;
  overflow: hidden;
  position: relative;
}

@media (max-width: 768px) {
  .container,
  .page-container,
  .header-content {
    padding: 0 16px;
  }
  
  .header-content {
    height: 50px;
  }
  
  svg {
    max-width: calc(100vw - 32px);
  }
}

@media (max-width: 480px) {
  .container,
  .page-container,
  .header-content {
    padding: 0 12px;
  }
  
  .header-content {
    height: 45px;
  }
  
  svg {
    max-width: calc(100vw - 24px);
  }
}

/* ===== BUTTON STYLES ===== */
.btn {
  padding: 12px 24px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  color: white;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
}

.btn-secondary {
  background: var(--surface);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.btn-secondary:hover {
  background: var(--border-color);
  transform: translateY(-1px);
}

.btn-danger {
  background: linear-gradient(135deg, var(--error-color), #dc2626);
  color: white;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
}

/* ===== FORM STYLES ===== */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
  font-size: 14px;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid var(--border-color);
  border-radius: 12px;
  font-size: 14px;
  font-family: inherit;
  background: var(--surface);
  color: var(--text-primary);
  transition: all 0.2s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.form-textarea {
  resize: vertical;
  min-height: 100px;
}

/* ===== TOAST STYLES ===== */
.toast {
  position: fixed;
  top: 24px;
  right: 24px;
  background: white;
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  border-left: 4px solid var(--primary-color);
  z-index: 3000;
  transform: translateX(400px);
  transition: all 0.3s ease;
  max-width: 400px;
}

.toast.show {
  transform: translateX(0);
}

.toast.success {
  border-left-color: var(--success-color);
}

.toast.error {
  border-left-color: var(--error-color);
}

.toast.warning {
  border-left-color: var(--warning-color);
}

.toast-content {
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.toast-icon {
  font-size: 20px;
  flex-shrink: 0;
  margin-top: 2px;
}

.toast-message {
  flex: 1;
}

.toast-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.toast-text {
  color: var(--text-secondary);
  font-size: 14px;
  line-height: 1.4;
}

/* Dark theme support for toasts */
[data-theme="dark"] .toast {
  background: var(--surface);
  border-color: var(--border-color);
}

/* ===== DAY/NIGHT SCENE ===== */
#scene {
  position: absolute;
  inset: 0;
  overflow: hidden;
  z-index: 0;
}

.sky {
  position: absolute;
  inset: 0;
  transition: background var(--t);
}

html.theme-day .sky {
  background: linear-gradient(to bottom, var(--sky-day-from), var(--sky-day-to));
}

[data-theme="dark"] .sky {
  background: linear-gradient(to bottom, var(--sky-night-from), var(--sky-night-to));
}

.sun, .moon {
  position: absolute;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  top: 10%;
  left: 10%;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--t);
}

.sun {
  background: var(--sun);
  box-shadow: 0 0 60px rgba(255,209,102,.6);
}

.moon {
  background: var(--moon);
  box-shadow: 0 0 40px rgba(229,231,255,.35);
}

html.theme-day .sun {
  opacity: 1;
}

[data-theme="dark"] .moon {
  opacity: 1;
}

.clouds {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.clouds::before, .clouds::after {
  content: "";
  position: absolute;
  top: 15%;
  left: -200px;
  width: 100px;
  height: 40px;
  filter: blur(1px);
  background: #fff;
  opacity: 0.8;
  border-radius: 50px;
  animation: clouds 60s linear infinite;
  
  box-shadow: 
    0 0 0 20px #fff,
    -30px -10px 0 10px #fff,
    -50px -5px 0 15px #fff,
    -35px 10px 0 8px #fff,
    30px -8px 0 12px #fff,
    50px -2px 0 18px #fff,
    40px 8px 0 10px #fff,
    -10px -20px 0 8px #fff,
    10px -25px 0 12px #fff,
    -25px -18px 0 6px #fff,
    25px -20px 0 9px #fff;
}

.clouds::after {
  top: 25%;
  left: 400px;
  opacity: 0.6;
  animation-duration: 80s;
  animation-delay: -20s;
  
  box-shadow: 
    0 0 0 25px #fff,
    -40px -5px 0 15px #fff,
    -20px -15px 0 10px #fff,
    -60px 5px 0 12px #fff,
    40px -10px 0 20px #fff,
    20px -20px 0 8px #fff,
    60px 0px 0 15px #fff,
    -15px 15px 0 8px #fff,
    15px 12px 0 10px #fff;
}

/* Thêm cloud thứ 3 */
.clouds::before {
  content: "";
  position: absolute;
  top: 10%;
  left: -300px;
  width: 80px;
  height: 35px;
  filter: blur(1px);
  background: #fff;
  opacity: 0.7;
  border-radius: 40px;
  animation: clouds 100s linear infinite;
  animation-delay: -40s;
  
  box-shadow: 
    0 0 0 18px #fff,
    -25px -8px 0 8px #fff,
    -40px -3px 0 12px #fff,
    -30px 8px 0 6px #fff,
    25px -6px 0 10px #fff,
    40px 0px 0 14px #fff,
    35px 6px 0 8px #fff,
    -8px -18px 0 6px #fff,
    8px -20px 0 10px #fff,
    -20px -15px 0 4px #fff,
    20px -18px 0 7px #fff;
}

@keyframes clouds {
  from { transform: translateX(-70vw); }
  to { transform: translateX(100vw); }
}

[data-theme="dark"] .clouds {
  opacity: .1;
  transition: opacity var(--t);
}

.grass {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 18vh;
  background: var(--grass-day);
  transform: translateY(100%);
  transition: transform var(--t), background var(--t);
}

html.theme-day .grass {
  transform: translateY(0);
}

[data-theme="dark"] .grass {
  background: var(--grass-night);
  transform: translateY(0);
}

#stars {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  opacity: 0;
  transition: opacity var(--t);
  pointer-events: none;
  z-index: 100;
  background: 
    radial-gradient(1px 1px at 5% 15%, #fff, transparent),
    radial-gradient(2px 2px at 15% 25%, #fff, transparent),
    radial-gradient(1px 1px at 25% 5%, #fff, transparent),
    radial-gradient(1px 1px at 35% 35%, #fff, transparent),
    radial-gradient(2px 2px at 45% 15%, #fff, transparent),
    radial-gradient(1px 1px at 55% 45%, #fff, transparent),
    radial-gradient(1px 1px at 65% 25%, #fff, transparent),
    radial-gradient(2px 2px at 75% 55%, #fff, transparent),
    radial-gradient(1px 1px at 85% 35%, #fff, transparent),
    radial-gradient(1px 1px at 95% 65%, #fff, transparent),
    radial-gradient(1px 1px at 10% 75%, #fff, transparent),
    radial-gradient(2px 2px at 20% 85%, #fff, transparent),
    radial-gradient(1px 1px at 30% 95%, #fff, transparent),
    radial-gradient(1px 1px at 40% 65%, #fff, transparent),
    radial-gradient(2px 2px at 50% 85%, #fff, transparent),
    radial-gradient(1px 1px at 60% 75%, #fff, transparent),
    radial-gradient(1px 1px at 70% 95%, #fff, transparent),
    radial-gradient(2px 2px at 80% 85%, #fff, transparent),
    radial-gradient(1px 1px at 90% 95%, #fff, transparent),
    radial-gradient(1px 1px at 8% 55%, #fff, transparent),
    radial-gradient(2px 2px at 18% 45%, #fff, transparent),
    radial-gradient(1px 1px at 28% 75%, #fff, transparent),
    radial-gradient(1px 1px at 38% 85%, #fff, transparent),
    radial-gradient(2px 2px at 48% 65%, #fff, transparent),
    radial-gradient(1px 1px at 58% 95%, #fff, transparent),
    radial-gradient(1px 1px at 68% 75%, #fff, transparent),
    radial-gradient(2px 2px at 78% 45%, #fff, transparent),
    radial-gradient(1px 1px at 88% 65%, #fff, transparent),
    radial-gradient(1px 1px at 98% 85%, #fff, transparent);
  background-size: 100vw 100vh;
  animation: twinkle 4s ease-in-out infinite alternate;
}

@keyframes twinkle {
  0% { opacity: 0.7; }
  50% { opacity: 1; }
  100% { opacity: 0.8; }
}

[data-theme="dark"] #stars {
  opacity: 1;
}

#tree {
  position: absolute;
  left: 50%;
  bottom: 10vh;
  transform: translateX(-50%);
  max-height: 85vh;
  max-width: 90%;
  width: auto;
  height: auto;
  filter: brightness(1);
  transition: filter var(--t);
  z-index: 2;
  object-fit: contain;
  /* Fix: Ngăn cây bị kéo */
  pointer-events: none;
  user-select: none;
  -webkit-user-drag: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

[data-theme="dark"] #tree {
  filter: brightness(.85) saturate(.9);
}

#app {
  position: relative;
  z-index: 2;
  width: 100%;
  height: 100%;
}

#leafCanvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 3;
  pointer-events: none;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 1200px) {
  #tree {
    max-height: 80vh;
    max-width: 85%;
  }
}

@media (max-width: 768px) {
  #tree {
    max-height: 70vh; /* Tăng từ 60vh để cây lớn hơn */
    max-width: 90%;
    bottom: 5vh; /* Tăng từ 2vh để cây cao hơn */
  }
  
  .btn {
    padding: 10px 20px;
    font-size: 13px;
  }
  
  .toast {
    top: 16px;
    right: 16px;
    left: 16px;
    max-width: none;
    transform: translateY(-100px);
  }
  
  .toast.show {
    transform: translateY(0);
  }
  
  /* Fix: Tối ưu header cho mobile */
  .header-content {
    height: 50px;
    padding: 0 12px;
  }
  
  /* Fix: Giảm khoảng cách top để ít scroll hơn */
  main {
    padding-top: 50px; /* Giảm padding top */
  }
  
  /* Fix: Điều chỉnh left panel cho mobile */
  .left-panel {
    top: 50px;
    padding: 12px;
    max-height: calc(100vh - 50px);
    overflow-y: auto;
  }
  
  /* Fix: Điều chỉnh stage height cho mobile */
  #stage {
    min-height: calc(100vh - 50px);
    padding-top: 0;
  }
}

@media (max-width: 480px) {
  #tree {
    max-height: 65vh; /* Tăng từ 55vh để cây lớn hơn trên mobile nhỏ */
    max-width: 85%;
    bottom: 3vh; /* Tăng từ 0vh để có khoảng cách đáy */
  }
  
  .form-input {
    padding: 10px 14px;
    font-size: 13px;
  }
  
  .btn {
    padding: 8px 16px;
    font-size: 12px;
  }
  
  /* Fix: Header nhỏ hơn cho mobile */
  .header-content {
    height: 45px;
    padding: 0 8px;
  }
  
  /* Fix: Giảm thêm padding top */
  main {
    padding-top: 45px;
  }
  
  /* Fix: Điều chỉnh left panel cho mobile nhỏ */
  .left-panel {
    top: 45px;
    padding: 8px;
    max-height: calc(100vh - 45px);
  }
  
  /* Fix: Stage layout cho mobile nhỏ */
  #stage {
    min-height: calc(100vh - 45px);
    padding-top: 0;
  }
  
  /* Fix: Button text nhỏ hơn cho mobile */
  .btn-text {
    font-size: 11px;
  }
}

/* View modal tweaks: make the message content larger and avoid visual "shrink"
   caused by transient transforms/animations. These rules only target the
   message/view modal so other modals keep their animation behavior. */
#modal .sheet {
  /* allow the view modal to be a bit wider for comfortable reading */
  max-width: 820px;
  width: min(92vw, 820px);
}

#modal .leaf-card {
  /* reduce the large left padding used by letter-style cards so text has more room */
  padding: 20px 20px 18px 20px;
  border-left-width: 6px;
}

#modal .leaf-text #modalText {
  font-size: 22px !important;
  line-height: 1.95 !important;
  font-weight: 500 !important;
  color: var(--ink) !important;
}

/* Prevent the view modal's content from inheriting transient transforms
   used for the opening animation that can make text appear smaller. This
   keeps the animation on the sheet container but ensures inner content is
   painted at normal scale when visible. */
#modal .sheet, #modal .sheet * {
  transform: none !important;
  -webkit-transform: none !important;
}

/* Further polish for the letter content inside the view modal */
#modal .leaf-card {
  display: block; /* ensure block flow */
  background: transparent;
  border-left-color: var(--accent);
  box-shadow: none;
}

#modal .leaf-text p {
  margin: 0 0 12px 0;
  font-size: 20px;
  line-height: 1.9;
  color: var(--ink);
  word-break: break-word;
}

/* Author (signature) styling: right aligned, lighter, visually separated */
#modal .leaf-text #modalAuthor {
  display: block;
  margin-top: 10px;
  text-align: right;
  font-size: 14px;
  color: var(--muted);
  font-style: italic;
  border-top: 1px dashed var(--border-color);
  padding-top: 10px;
}

/* Action buttons inside modal: full-width stack on small screens, aligned row on larger */
#modal .leaf-actions {
  margin-top: 18px;
  display: flex;
  gap: 10px;
  align-items: center;
}

@media (max-width: 520px) {
  #modal .leaf-actions { flex-direction: column-reverse; }
  #modal .leaf-actions .btn { width: 100%; }
}

/* Modal leaf preview image (view modal) */
#modal .leaf-card {
  display: flex;
  gap: 18px;
  align-items: flex-start;
}

#modal .leaf-preview {
  flex: 0 0 120px;
  width: 120px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  background: var(--bg-secondary);
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

#modal .modal-leaf-image {
  width: 140%; /* intentionally larger so leaf visually overflows frame */
  height: auto;
  transform-origin: center center;
  display: block;
  pointer-events: none;
}

@media (max-width: 520px) {
  #modal .leaf-card { flex-direction: column; }
  #modal .leaf-preview { width: 100%; height: 140px; flex: none; }
  #modal .modal-leaf-image { width: auto; max-height: 120px; }
}

/* === Strong overrides for modal previews and add-modal animation === */
/* Ensure preview boxes are transparent and image is not framed */
#modal .leaf-preview,
#addModal .preview,
#addModal .leaf-preview {
  background: transparent !important;
  box-shadow: none !important;
  border: none !important;
  padding: 0 !important;
}

#modal .modal-leaf-image,
#addModal .preview .preview-image,
.preview-image.fill-frame {
  background: transparent !important;
  max-width: 100% !important;
  max-height: 100% !important;
  object-fit: contain !important;
}

/* Reduce the opening scale for Add modal so it doesn't visually 'shrink' too much.
   Keep a subtle entrance but avoid aggressive scale transform that makes content
   appear small during animation. */
/* Positioning: anchor sheet near top so it doesn't get covered and is scollable */
#addModal .sheet {
  transform: none !important;
  opacity: 1 !important;
  margin: 12px auto !important;
  transition: none !important;
  position: relative !important;
  top: 0 !important;
}
#addModal.modal.show .sheet {
  transform: none !important;
  opacity: 1 !important;
  animation: none !important;
}

/* Make Add modal more spacious and less narrow */
#addModal .sheet {
  max-width: 1000px !important; /* wider canvas for create flow */
  width: min(96vw, 1000px) !important;
  padding: 24px !important;
  border-radius: 12px !important;
}
/* Make sheet scrollable when content is taller than viewport */
#addModal .sheet {
  max-height: calc(100vh - 64px) !important; /* leave gap from top/bottom */
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch;
}

/* Layout: two-column picker on larger screens to use space well */
#addModal .picker {
  display: grid;
  grid-template-columns: 1fr 360px; /* give the preview more width */
  gap: 18px;
  align-items: start;
}

@media (max-width: 920px) {
  #addModal .picker { grid-template-columns: 1fr; }
}

/* Make preview on the right larger and centered; desktop gets larger canvas */
#addModal .preview { border-radius: 12px; padding: 14px; }
#addModal .preview .preview-image-wrap { width: 280px; height: 280px; display:flex; align-items:center; justify-content:center; }
#addModal .preview .modal-leaf-image, #addModal .preview .preview-image { max-width: 280px; max-height: 280px; }

/* Improve spacing of modal header and actions */
#addModal h3 { font-size: 22px; margin-bottom: 12px; }
#addModal .form-section { margin-bottom: 14px; }
#addModal .sheet > div[style*="display:flex"] { margin-top: 20px; }

/* Compact, centered preview for Add modal: smaller frame, no overflow, neat padding */
#addModal .preview {
  display:flex; align-items:center; gap:16px; padding:12px; border-radius:12px;
  background: transparent !important; box-shadow: none !important; border: 1px solid rgba(0,0,0,0.04);
}
/* inner preview holder for legacy selectors */
#addModal .preview .preview-leaf { height: 280px; display:flex; align-items:center; justify-content:center; }

/* Responsive: keep preview comfortable on medium and small screens */
@media (max-width: 920px) {
  #addModal .preview .preview-image-wrap { width: 200px; height: 200px; }
  #addModal .preview .modal-leaf-image, #addModal .preview .preview-image { max-width: 200px; max-height: 200px; }
  #addModal .preview .preview-leaf { height: 200px; }
}

@media (max-width: 520px) {
  #addModal .preview .preview-image-wrap { width: 140px; height: 140px; }
  #addModal .preview .modal-leaf-image, #addModal .preview .preview-image { max-width: 140px; max-height: 140px; }
  #addModal .preview .preview-leaf { height: 140px; }
}

/* Form spacing inside add modal */
#addModal .picker-row { margin-bottom: 12px; }
#addModal .picker-row label { display:block; margin-bottom:6px; font-weight:600; }

/* No forced inheritance for transforms — allow JS to control preview image transforms. */



